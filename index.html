<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Guilda SPTECH</title>
    <link href="https://unpkg.com/nes.css@latest/css/nes.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Press+Start+2P" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Press Start 2P', cursive;
            background-color: black;
            color: white;
            padding: 2rem;
        }
        .container { max-width: 900px; margin: 0 auto; }
        .card-heroi { margin-bottom: 20px; }
        .avatar { font-size: 2rem; margin-right: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div style="text-align: center; margin-bottom: 2rem;">
        <i class="nes-icon trophy is-large"></i>
        <h1>Guilda SPTECH</h1>
        <p>Gest√£o de Aventureiros</p>
    </div>

    <div class="nes-container with-title is-centered" style="border-color: white;">
        <p class="title" style="background-color: black; color: white;">Novo Recruta</p>
        <div style="background-color: black; color: white; padding: 1rem;">
            
            <div class="nes-field">
                <label for="nome">Nome do Her√≥i:</label>
                <input type="text" id="nome" class="nes-input" placeholder="Ex: Gandalf">
            </div>
            
            <br>
            
            <div class="nes-field">
                <label for="classe">Classe:</label>
                <div class="nes-select">
                    <select id="classe">
                        <option value="" disabled selected>Escolha a Classe...</option>
                        <option value="GUERREIRO">Guerreiro</option>
                        <option value="MAGO">Mago</option>
                        <option value="ARQUEIRO">Arqueiro</option>
                        <option value="LADINO">Ladino</option>
                        <option value="BRUXO">Bruxo</option>
                        <option value="CLERIGO">Cl√©rigo</option>
                        <option value="BARDO">Bardo</option>
                    </select>
                </div>
            </div>

            <br>
            <button type="button" class="nes-btn is-primary" onclick="cadastrar()">Recrutar</button>
        </div>
    </div>

    <br><br>

    <div class="nes-container with-title is-dark" style="border-color: white;">
        <p  style="background-color: transparent; color: white;">Membros da Guilda</p>
        <div id="lista-herois">
            <p>Carregando taverna...</p>
        </div>
    </div>
</div>

<script>
    // URL base da sua API (Porta definida no application.properties)
    const API_URL = 'http://localhost:8080/aventureiros';

    // --- 1. LISTAR (GET /listar) ---
    async function carregarTaverna() {
        try {
            const resposta = await fetch(`${API_URL}/listar`);
            const herois = await resposta.json();
            
            const lista = document.getElementById('lista-herois');
            lista.innerHTML = ''; 

            if(herois.length === 0) {
                lista.innerHTML = '<p>A taverna est√° vazia...</p>';
                return;
            }

            herois.forEach(heroi => {
                // Calcula % de XP para a barra de progresso
                const porcentagemXp = heroi.xp; 

                lista.innerHTML += `
                    <div class="nes-container is-rounded is-dark card-heroi" style="color: white;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h3>${getIcone(heroi.classe)} ${heroi.nome}</h3>
                                <span class="nes-badge">
                                    <span class="is-dark">${heroi.classe}</span>
                                </span>
                                <span class="nes-badge">
                                    <span class="is-warning">N√≠vel ${heroi.nivel}</span>
                                </span>
                            </div>
                            <button class="nes-btn is-error" onclick="deletar(${heroi.id})">X</button>
                            <button class="nes-btn is-error" onclick="irParaMissao(${heroi.id})">
                                ‚öîÔ∏è Miss√£o
                            </button>
                        </div>
                        
                        <div style="margin-top: 10px;">
                            <span>XP: ${heroi.xp} / 100</span>
                            <progress class="nes-progress is-success" value="${porcentagemXp}" max="100"></progress>
                        </div>
                    </div>
                `;
            });
        } catch (erro) {
            console.error(erro);
            alert("Erro ao conectar com a API. O backend est√° rodando?");
        }
    }

    // --- 2. CADASTRAR (POST /criar) ---
    async function cadastrar() {
        const nome = document.getElementById('nome').value;
        const classe = document.getElementById('classe').value;

        if (!nome || !classe) return alert("Preencha os dados do her√≥i!");

        await fetch(`${API_URL}/criar`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ nome, classe })
        });

        document.getElementById('nome').value = '';
        document.getElementById('classe').value = '';
        carregarTaverna();
    }

    // --- 3. MISS√ÉO (PUT /missao/{id}) ---
    async function irParaMissao(id) {
        await fetch(`${API_URL}/missao/${id}`, { method: 'PUT' });
        carregarTaverna(); 
    }

    function getIcone(classe) {
        const icones = {
            'GUERREIRO': 'üõ°Ô∏è', 'MAGO': 'üîÆ', 'ARQUEIRO': 'üèπ',
            'LADINO': 'üó°Ô∏è', 'BRUXO': 'üß™', 'CLERIGO': '‚ú®', 'BARDO': 'üéµ'
        };
        return icones[classe] || 'üßë‚Äçüé§';
    }

    // --- 4. DELETAR (NOVO) ---
    async function deletar(id) {
        // Confirma√ß√£o simples para evitar cliques acidentais
        if(!confirm("Tem certeza que deseja expulsar este aventureiro da guilda?")) return;

        try {
            // Aten√ß√£o √† URL: /deletar/{id} conforme seu Controller
            await fetch(`${API_URL}/deletar/${id}`, { 
                method: 'DELETE' 
            });
            carregarTaverna(); // Recarrega a lista ap√≥s deletar
        } catch (erro) {
            alert("Erro ao deletar aventureiro!");
        }
    }

    // Carrega ao abrir a p√°gina
    carregarTaverna();
</script>

</body>
</html>